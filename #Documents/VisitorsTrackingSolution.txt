ğŸ“‹ Visitor Analytics System - Complete File Summary

ğŸ”§ BACKEND FILES
File PathPurposeKey Notesapp/Livewire/VisitorAnalytics.phpMain analytics dashboard componentDisplays stats, filters, search, session details with drill-downapp/Models/VisitorLog.phpDatabase model for visitor logsStores all visitor session data with timestampsapp/Http/Middleware/LogAllVisitors.phpTracks every page visitSession-based tracking - updates existing session within 30 min, creates new after timeoutapp/Listeners/CloseVisitorSession.phpCloses session on logoutFires when user clicks logout - sets disconnected_at in real-timeapp/Console/Commands/CloseInactiveSessions.phpCleanup stale sessionsCloses sessions inactive for 30+ minutes (for users who close browser)app/Providers/EventServiceProvider.phpRegisters logout listenerMaps Logout event to CloseVisitorSession listenerapp/Console/Kernel.phpSchedules automated tasksRuns cleanup command every 10 minutes

ğŸ—„ï¸ DATABASE FILES
File PathPurposeKey Columnsdatabase/migrations/2025_12_09_204103_create_visitor_logs_table.phpCreates visitor_logs tableid, user_id, username, ip_address, user_agent, page_url, connected_at, disconnected_at, updated_at, visitor_type, bot_type, browser, platform, is_mobile, session_id
Table Structure Notes:

connected_at = Session start time
updated_at = Last activity (updates on every page click)
disconnected_at = Session end (set by logout or cleanup command)
visitor_type = user, anonymous, or bot


ğŸ¨ FRONTEND FILES
File PathPurposeFeaturesresources/views/livewire/visitor-analytics.blade.phpMain dashboard viewStats cards, filters, visitor list, expandable session detailsresources/views/components/layouts/app/visitor-analytics.blade.phpLayout wrapperHeader with logo/theme toggle, footer, scroll-to-top button
UI Features:

6 stat cards (Total, Users, Anonymous, Bots, Active Now, Time Range)
Filter tabs (Users, Anonymous, Bots, All)
Search by username/IP/URL
Expandable rows showing session history
"Clear All Logs" button (Super Admin only)
Real-time active session indicators


ğŸ›£ï¸ ROUTES
RouteFile LocationAccess/visitor-analyticsroutes/web.phpSuper Admin only
phpRoute::middleware(['auth', 'verified', 'role:Super Admin'])->group(function () {
    Route::get('/visitor-analytics', VisitorAnalytics::class)->name('visitor.analytics');
});
```

---

### **ğŸ“¦ DEPENDENCIES**

| Package | Purpose | Installation |
|---------|---------|--------------|
| `jenssegers/agent` | Browser/OS/bot detection | `composer require jenssegers/agent` |
| Spatie Permissions | Role-based access control | Already installed (Super Admin check) |

---

### **âš™ï¸ CONFIGURATION**

| Setting | Value | Purpose |
|---------|-------|---------|
| Session Timeout | 30 minutes | How long before creating new session |
| Cleanup Frequency | Every 10 minutes | How often to close stale sessions |
| Pagination | 20 per page | Visitor list pagination |

---

### **ğŸ”„ DATA FLOW**
```
1. User visits page
   â†“
2. LogAllVisitors middleware fires
   â†“
3. Check: Active session within 30 min?
   â”œâ”€ YES: Update existing session (updated_at)
   â””â”€ NO: Create new session
   â†“
4. User clicks around (step 2-3 repeat)
   â†“
5a. User clicks LOGOUT
    â†“
    CloseVisitorSession listener
    â†“
    Set disconnected_at = NOW() âœ…
    
5b. User closes browser
    â†“
    Wait 30+ minutes
    â†“
    CloseInactiveSessions command runs
    â†“
    Set disconnected_at = updated_at âœ…

ğŸ“Š KEY METRICS TRACKED
MetricDescriptionTotal SessionsAll visitor sessions in selected time rangeRegistered UsersSessions by authenticated usersUnique UsersCount of distinct usernamesAnonymousSessions without loginBotsCrawler/spider sessionsActive NowSessions with disconnected_at = NULLSession DurationTime between connected_at and disconnected_atLast ActivityMost recent updated_at timestamp

ğŸ¯ FEATURES SUMMARY
âœ… Session-based tracking (not page view counting)
âœ… Real-time logout detection
âœ… Automatic cleanup for abandoned sessions
âœ… Bot detection and classification
âœ… Browser/OS/device tracking
âœ… IP address logging
âœ… Search and filtering
âœ… Expandable session details
âœ… Time range filtering (1h, 24h, week, month, all time)
âœ… Dark mode support
âœ… Mobile responsive
âœ… Role-based access (Super Admin only)
âœ… Clear all logs functionality

Total: 9 files + 1 migration + 1 dependency = Complete visitor analytics system ğŸš€