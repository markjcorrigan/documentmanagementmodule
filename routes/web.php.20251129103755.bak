<?php

// Laravel Core
use App\Events\ChatMessage;
use App\Http\Controllers\AuthenticatedSessionController;
use App\Http\Controllers\backend\AdminController;
use App\Http\Controllers\backend\BlogPostController;
use App\Http\Controllers\backend\CommentController;
use App\Http\Controllers\backend\HeroController;
use App\Http\Controllers\backend\PortfolioController;
use App\Http\Controllers\backend\ResumeController;
use App\Http\Controllers\backend\ServicesController;
use App\Http\Controllers\backend\SiteSettingsController;
use App\Http\Controllers\backend\SkillsController;
use App\Http\Controllers\backend\TestimonialController;
use App\Http\Controllers\DocumentController;
use App\Http\Controllers\DocumentDownloadController;
use App\Http\Controllers\EditorController;
use App\Http\Controllers\FileDemoController;
use App\Http\Controllers\FollowController;
use App\Http\Controllers\frontend\FrontendController;
use App\Http\Controllers\frontend\UserPostsBlogPostController;
use App\Http\Controllers\ImageController;
use App\Http\Controllers\ImageDemoController;
use App\Http\Controllers\IndexController;
use App\Http\Controllers\JokecatController;
use App\Http\Controllers\JokeController;
use App\Http\Controllers\MailerController;
use App\Http\Controllers\PmboksixController;
use App\Http\Controllers\StuffController;
use App\Http\Controllers\TinymceController;
use App\Http\Controllers\UserController;
use App\Livewire\AboutPmway;
use App\Livewire\Accelerate;
use App\Livewire\AcidDatabase;
use App\Livewire\AgileMethodsCarousel;
use App\Livewire\AgilevsTraditional;
use App\Livewire\AmericanFootball;
use App\Livewire\AmericanFootballVideos;
use App\Livewire\ATemplate;
use App\Livewire\Avatarform;
use App\Livewire\Blog\CreatePost;
use App\Livewire\Blog\EditPost;
use App\Livewire\Blog\ProfilePosts;
use App\Livewire\Blog\SinglePost;
use App\Livewire\BurndownShort;
use App\Livewire\CapabilityMaturityModel;
use App\Livewire\CarouselCard;
use App\Livewire\CategoriesManager;
use App\Livewire\Chat\ChatDashboard;
use App\Livewire\CmmiDevDashboard;
use App\Livewire\CMMiLanding;
use App\Livewire\CmmiLevelOne;
use App\Livewire\CrocodileHunter;
use App\Livewire\DocumentUploader;
use App\Livewire\DoneDone;
use App\Livewire\EthosLogosPathos;
use App\Livewire\GameStats;
use App\Livewire\HamAndEggs;
use App\Livewire\Home;
use App\Livewire\ItilFourPractices;
use App\Livewire\JobViewer;
use App\Livewire\KanbanCoffee;
use App\Livewire\Livewireprocs;
use App\Livewire\NotesManager;
use App\Livewire\PersonalKanban;
use App\Livewire\PmbokProcessExample;
use App\Livewire\PmbokProcessNutshell;
use App\Livewire\Pmway\Laws;
use App\Livewire\PrivateOne;
use App\Livewire\ProductIncrement;
use App\Livewire\RedBeadExperiment;
use App\Livewire\ReleaseManagement;
use App\Livewire\SafeCritique;
use App\Livewire\Sbokfour;
use App\Livewire\ScrumDashboards;
use App\Livewire\Scrumfix;
use App\Livewire\SevenFs;
use App\Livewire\SevenRulesOfScrum;
use App\Livewire\Snowbird;
use App\Livewire\StyleGuide;
use App\Livewire\ThePMWay;
use App\Livewire\VModel;
use App\Livewire\WorkCarousel;
use App\Livewire\WorkingSoftware;
use App\Livewire\Writefull;
use Illuminate\Support\Facades\Artisan;
use Illuminate\Support\Facades\Route;


// Events

// Main Controllers

// Backend Controllers

// Frontend Controllers

// Livewire Components


//Joke Routes

// Notes Routes

// Document Uploader / Downloader Routes

// Chat Module


////// NEW BLOG ROUTES

/// STYLE GUIDE

////test route to grap pdf's

///////////////////////////////////////////NB NO CACHE created in Middleware NoCache.php
/// created in Middleware NoCache.php
/// no-cache: Browser can cache, but must revalidate with server before using cached version
//
//no-store: Browser cannot cache this page at all
//
//must-revalidate: Browser must check with server if cached version is still valid
//
//Pragma: no-cache: Legacy header for older browsers
//
//Expires: 0: Page expired immediately
//Route::get('/login', [LoginController::class, 'showLoginForm'])
//->middleware('nocache');
//Where to Use It:
//1. In Your Login Controller:
//php
//public function showLoginForm()
//{
//    return response()->noCache(view('auth.login'));
//}
//
//public function showRegistrationForm()
//{
//    return response()->noCache(view('auth.register'));
//}
//2. In Your Dashboard/Protected Pages:
//php
//public function dashboard()
//{
//    return response()->noCache(view('dashboard'));
//}
//3. In Livewire Components (if they render views):
//php
//public function render()
//{
//    return response()->noCache(view('livewire.some-component'));
//}


////test route
//Route::get('/test-auth', function() {
//    return response()->json([
//        'authenticated' => auth()->check(),
//        'user_id' => auth()->id(),
//        'user_name' => auth()->user()?->name,
//        'guard' => config('auth.defaults.guard'),
//        'session_driver' => config('session.driver'),
//        'session_id' => session()->getId(),
//    ]);
//})->middleware('web');

//Route::get('/session-test', function() {
//    session(['cross_machine_test' => now()->toDateTimeString()]);
//
//    return response()->json([
//        'status' => auth()->check() ? 'logged_in' : 'guest',
//        'user_id' => auth()->id(),
//        'session_id' => session()->getId(),
//        'session_data' => session()->all(),
//        'cookie_domain' => config('session.domain'),
//        'secure' => config('session.secure'),
//        'app_url' => config('app.url')
//    ]);
//});
//
///////
//Route::get('/auth-test', function() {
//    // Try to log in a test user
//    if (!auth()->check()) {
//        $user = \App\Models\User::first(); // Get first user
//        if ($user) {
//            auth()->login($user);
//            \Log::info('Manual login attempted', ['user_id' => $user->id, 'session_id' => session()->getId()]);
//        }
//    }
//
//    return response()->json([
//        'authenticated' => auth()->check(),
//        'user_id' => auth()->id(),
//        'user' => auth()->user() ? ['id' => auth()->user()->id, 'name' => auth()->user()->name] : null,
//        'session_id' => session()->getId(),
//        'cookie_domain' => config('session.domain')
//    ]);
//});


/*
|--------------------------------------------------------------------------
| Public Routes
|--------------------------------------------------------------------------
*/


// routes/web.php


/*
|--------------------------------------------------------------------------
| A Livewire Tailwind CSS Dark Light template
|--------------------------------------------------------------------------
*/


Route::get('/atemplate', ATemplate::class)->name('atemplate');

/*
|--------------------------------------------------------------------------
| Livewire Style Guide for Tailwind
|--------------------------------------------------------------------------
*/


Route::get('/style-guide', StyleGuide::class);

/*
|--------------------------------------------------------------------------
| Livewire converted route from legacy
|--------------------------------------------------------------------------
*/




//Route::get('/the-pmway', ThePMWay::class)->name('the-pmway')->middleware('auth');
Route::get('/the-pmway', ThePMWay::class)->name('the-pmway');

// Route::get('/stats', GameStats::class)->name('stats')->middleware('auth');
Route::get('/gamestats', GameStats::class)->name('gamestats');

//Route::get('/agile-traditional', AgilevsTraditional::class)->name('agile-traditional')->middleware('auth');
Route::get('/agile-traditional', AgilevsTraditional::class)->name('agile-traditional');

//Route::get('/scrumfix', Scrumfix::class)->name('scrumfix')->middleware('auth');
Route::get('/scrumfix', Scrumfix::class)->name('scrumfix');

Route::get('/about-pmway', AboutPmway::class)->name('about-pmway');

//Route::get('/cmmi-level-one', CmmiLevelOne::class)->name('cmmi.level-one')->middleware('auth');
Route::get('/cmmi-level-one', CmmiLevelOne::class)->name('cmmi-level-one');

//Route::get('/done-done', DoneDone::class)->name('done.done')->middleware('auth');
Route::get('/done-done', DoneDone::class)->name('done-done');

//Route::get('/crocodile-hunter', CrocodileHunter::class)->name('crocodile.hunter')->middleware('auth');
Route::get('/crocodile-hunter', CrocodileHunter::class)->name('crocodile-hunter');

//Route::get('/acid-database', AcidDatabase::class)->name('acid.database')->middleware('auth');
Route::get('/acid-database', AcidDatabase::class)->name('acid-database');

//Route::get('/ethos-logos-pathos', EthosLogosPathos::class)->name('ethos.logos.pathos')->middleware('auth');
Route::get('/ethos-logos-pathos', EthosLogosPathos::class)->name('ethos-logos-pathos');

//Route::get('/personal-kanban', PersonalKanban::class)->name('personal.kanban')->middleware('auth');
Route::get('/personal-kanban', PersonalKanban::class)->name('personal-kanban');

//Route::get('/laws', Laws::class)->name('laws')->middleware('auth');
Route::get('/laws', Laws::class)->name('laws');

//Route::get('/agile-methods', AgileMethodsCarousel::class)->name('agile.methods')->middleware('auth');
Route::get('/agile-methods', AgileMethodsCarousel::class)->name('agile.methods');

//Route::get('/cmm-landing', CmmLanding::class)->name('cmm.landing')->middleware('auth');
Route::get('/cmmi-landing', CMMiLanding::class)->name('cmmi-landing');

//Route::get('/red-bead-experiment', RedBeadExperiment::class)->name('red-bead-experiment')->middleware('auth');
Route::get('/red-bead-experiment', RedBeadExperiment::class)->name('red-bead-experiment');


//Route::get('/scrum-dashboards', ScrumDashboards::class)->name('scrum.dashboards')->middleware('auth');
Route::get('/scrum-dashboards', ScrumDashboards::class)->name('scrum.dashboards');

//Route::get('/pmbok-process-4-1', PmbokProcessExample::class)->name('pmbok.process.example')->middleware('auth');
Route::get('/pmbok-process-example', PmbokProcessExample::class)->name('pmbok.process.example');

//Route::get('/v-model', VModel::class)->name('v.model')->middleware('auth');
Route::get('/vmodel', VModel::class)->name('vmodel');

//Route::get('/cmmidevdashboard', CmmiDevDash::class)->name('cmmidevdashboard')->middleware('auth');
Route::get('/cmmidevdashboard', CmmiDevDashboard::class)->name('cmmidevdashboard');


//Route::get('/burndownshort', BurndownShort::class)->name('burndownshort')->middleware('auth');
Route::get('/burndownshort', BurndownShort::class)->name('burndownshort');

//Route::get('/hamandeggs', HamAndEggs::class)->name('hamandeggs')->middleware('auth');
Route::get('/hamandeggs', HamAndEggs::class)->name('hamandeggs');

//Route::get('/kanbancoffee', KanbanCoffee::class)->name('kanban.coffee')->middleware('auth');
Route::get('/kanbancoffee', KanbanCoffee::class)->name('kanban.coffee');

//Route::get('/seven-rules-of-scrum', SevenRulesOfScrum::class)->name('seven-rules-of-scrum')->middleware('auth');
Route::get('/seven-rules-of-scrum', SevenRulesOfScrum::class)->name('seven-rules-of-scrum');

//Route::get('/accelerate', Accelerate::class)->name('accelerate')->middleware('auth');
Route::get('/accelerate', Accelerate::class)->name('accelerate');

//Route::get('/working-software', WorkingSoftware::class)->name('working.software')->middleware('auth');
Route::get('/working-software', WorkingSoftware::class)->name('working.software');

//Route::get('/release-management', ReleaseManagement::class)->name('release.management')->middleware('auth');
Route::get('/release-management', ReleaseManagement::class)->name('release.management');

//Route::get('/product-increment', ProductIncrement::class)->name('product.increment')->middleware('auth');
Route::get('/product-increment', ProductIncrement::class)->name('product.increment');

//Route::get('/safe-critique', SafeCritique::class)->name('safe.critique')->middleware('auth');
Route::get('/safe-critique', SafeCritique::class)->name('safe.critique');

//Route::get('/itilfourpractices', ItilFourPractices::class)->name('itilfourpractices')->middleware('auth');
Route::get('/itilfourpractices', ItilFourPractices::class)->name('itilfourpractices');

// routes/web.php
//Route::get('/snowbird', nowbirdPlaylist::class)->name('snowbird')->middleware('auth');
Route::get('/snowbird', Snowbird::class)->name('snowbird');

//Route::get('/american-football', AmericanFootball::class)->name('american-football')->middleware('auth');
Route::get('/american-football', AmericanFootball::class)->name('american-football');


//Route::get('/american-football-videos', AmericanFootballVideos::class)->name('american-football.videos')->middleware('auth');
Route::get('/american-football-videos', AmericanFootballVideos::class)->name('american-football.videos');


//Route::get('/sevenfs', SevenFs::class)->name('sevenfs')->middleware('auth');
Route::get('/sevenfs', SevenFs::class)->name('sevenfs');





/*
|--------------------------------------------------------------------------
| Livewire Notes App
|--------------------------------------------------------------------------
*/

Route::middleware(['auth'])->group(function () {
    Route::get('/notes', NotesManager::class)->name('notes.index');
    Route::get('/notes/categories', CategoriesManager::class)->name('notes.categories');
});


// Blog route for documents from BlogPostSeeder

Route::get('/download/assets/{filename}', function ($filename) {
    $filename = basename($filename);

    $filePath = storage_path('app/public/assets/' . $filename);

    if (!File::exists($filePath)) {
        abort(404, 'File not found');
    }

    $allowedExtensions = ['pdf', 'zip', 'doc', 'docx', 'xls', 'xlsx'];
    $extension = strtolower(pathinfo($filename, PATHINFO_EXTENSION));

    if (!in_array($extension, $allowedExtensions)) {
        abort(403, 'File type not allowed');
    }

    return response()->download($filePath);
})->middleware('auth')->name('download.asset');

// My CV Certificates etc.

Route::get('/mycv', \App\Livewire\CvIndex::class)->name('mycv')->middleware('permission:mycv noaccess');

// Jobs
Route::get('/workcarousel', WorkCarousel::class);


// Main landing page
//Route::get('/', function () {
//    return response()->file(public_path('cv/index.html'));
//});  changed this to home page


// Contact forms
Route::get('/contact', function () {
    return view('contact');
})->name('contact');

// TinyMCE & Editor
Route::post('/tinymce/upload', [TinymceController::class, 'upload'])->name('tinymce.upload');
Route::get('/editor/{filename?}', [EditorController::class, 'load'])->name('editor.load');
Route::post('/editor/save', [EditorController::class, 'save'])->name('editor.save');
Route::post('/editor/delete/{filename}', [EditorController::class, 'delete'])->name('editor.delete');

// Utility routes
Route::view('/tailwind', 'tailwind')->name('tailwind');
Route::get('/simulate-500', function () {
    abort(500, 'Simulated 500 error');
});


/*
|--------------------------------------------------------------------------
| CHAT MODULE
|--------------------------------------------------------------------------
*/

Route::get('/chat', ChatDashboard::class)->name('chat.index');

/*
|--------------------------------------------------------------------------
| Test route to test intervention image and GD
|--------------------------------------------------------------------------
*/


//Route::get('/test-gd', function() {
//    dd([
//        'extension_loaded' => extension_loaded('gd'),
//        'function_exists' => function_exists('gd_info'),
//        'gd_info' => gd_info(),
//        'php_version' => phpversion(),
//    ]);
//});

/*
|--------------------------------------------------------------------------
| System Administration Routes
|--------------------------------------------------------------------------
*/

Route::get('/optimize', function () {
    $kernel = app()->make(Illuminate\Contracts\Console\Kernel::class);
    $commands = [
        'queue:restart' => 'Queue restarted',
        'cache:clear' => 'Cache cleared',
        'config:cache' => 'Config cached',
        'route:clear' => 'Routes cleared',
        'view:clear' => 'Views cleared',
        'optimize:clear' => 'Optimization cleared',
        'optimize' => 'Optimization completed',
        'config:clear' => 'Config cleared',
    ];

    foreach ($commands as $command => $message) {
        $kernel->call($command);
        echo "$message.\n";
        flush();
    }

    exec('composer dump-autoload', $output, $result);
    echo "Composer autoload dumped.\n";
    echo 'All optimization steps completed!';
    flush();
});

Route::get('routeslisting', function () {
    $routeCollection = Route::getRoutes();
    echo "<table style='width:100%'>";
    echo "<tr><td width='10%'><h4>HTTP Method</h4></td><td width='10%'><h4>Route</h4></td><td width='10%'><h4>Name</h4></td><td width='70%'><h4>Action</h4></td></tr>";
    foreach ($routeCollection as $value) {
        echo "<tr><td>{$value->methods()[0]}</td><td>{$value->uri()}</td><td>{$value->getName()}</td><td>{$value->getActionName()}</td></tr>";
    }
    echo "</table>";
});

Route::get('/route-cache', function () {
    try {
        $exitCode = Artisan::call('route:cache');
        return $exitCode === 0 ? 'Route cache generated!' : 'Error generating route cache: ' . Artisan::output();
    } catch (\Exception $e) {
        return 'Error generating route cache: ' . $e->getMessage();
    }
});

Route::get('/route-clear', function () {
    try {
        Artisan::call('route:clear');
        return 'Route cache cleared!';
    } catch (\Exception $e) {
        return 'Error clearing route cache: ' . $e->getMessage();
    }
});

/*
|--------------------------------------------------------------------------
| PMBOK 6 Nutshell Route
|--------------------------------------------------------------------------
*/


// Example route configuration
Route::get('/pmboknutshell', PmbokProcessNutshell::class)
    ->name('pmboknutshell')->middleware('auth');


/*
|--------------------------------------------------------------------------
| File Management Routes
|--------------------------------------------------------------------------
*/


Route::get('/myfile-demo', [FileDemoController::class, 'index'])->name('myfile-demo');
Route::delete('/myfile-demo/{id}', [FileDemoController::class, 'destroy'])->name('myfile-demo.destroy');
Route::get('/myfile-demo/file/{filename}', [FileDemoController::class, 'serve'])->name('myfile-demo.serve');

Route::get('/myimage-demo', [ImageDemoController::class, 'index'])->name('myimage-demo');
Route::delete('/myimage-demo/{id}', [ImageDemoController::class, 'destroy'])->name('myimage-demo.destroy');
Route::get('/myimage-demo/image/{imagename}', [ImageDemoController::class, 'serve'])->name('myimage-demo.serve');

Route::post('upload-file', [IndexController::class, 'uploadFile'])
    ->middleware(['auth', 'verified', 'permission:file demo']);


// File preview routes - PDF  (ITIL4Guides and etc.)
Route::get('viewpdf/{subfolder}/{filename}', [IndexController::class, 'viewpdf'])
    ->where('filename', '.*')
    ->middleware('auth')
    ->name('viewpdf');

// File preview routes - Video
Route::get('viewvideo/{subfolder}/{filename}', [IndexController::class, 'viewvideo'])
    ->where('subfolder', '[^/]+')
    ->where('filename', '.*')
    ->middleware('auth')
    ->name('viewvideo');

// Download routes
Route::get('download/{subfolder}/{filename}', [IndexController::class, 'saveAction'])
    ->where('subfolder', '[^/]+')
    ->where('filename', '.*')
    ->middleware('auth')
    ->name('download');

// ZIP downloads (no subfolder needed - ZIPs are in root of assets)
Route::get('downloadzip/{filename}', [IndexController::class, 'downloadZip'])
    ->where('filename', '.*')
    ->middleware('auth')
    ->name('downloadzip');

// User view file route (already in your controller)
Route::get('user-view/{subfolder}/{filename}', [IndexController::class, 'userViewFile'])
    ->middleware('auth')
    ->name('user.view.file');

// Legacy PDF download route (keep if you're using it elsewhere)
Route::get('/download-pdf/{filename}', [IndexController::class, 'downloadPdf'])
    ->name('download.pdf');


// Dynamic page loader (keep last to avoid conflicts)
Route::get('home/{page}', [IndexController::class, 'homePage'])->where('page', '.*');

/*
|--------------------------------------------------------------------------
| File Pond
|--------------------------------------------------------------------------
*/


Route::middleware(['auth', 'role:Super User'])->group(function () {
    Route::get('/admin/upload-documents', DocumentUploader::class)
        ->name('admin.upload.documents');
});

Route::middleware(['auth'])->group(function () {

    Route::get('/admin/document-manager', DocumentUploader::class)
        ->name('admin.document.manager')
        ->middleware('permission:manage documents');

// Download routes - requires permission
    Route::get('/admin/documents/download', [DocumentDownloadController::class, 'download'])
        ->name('admin.download.document')
        ->middleware('permission:manage documents');

    Route::get('/admin/documents/view', [DocumentDownloadController::class, 'view'])
        ->name('admin.view.document')
        ->middleware('permission:manage documents');
});


/*
|--------------------------------------------------------------------------
| Frontend Routes
|--------------------------------------------------------------------------
*/

Route::get('/blog', [FrontendController::class, 'blog'])->name('blog');
Route::get('/portfolio', [FrontendController::class, 'portfolio'])->name('portfolio');
Route::get('/post/details/{slug}', [FrontendController::class, 'BlogDetails']);
Route::get('/post/details/{id}', [FrontendController::class, 'BlogDetails']);
Route::post('store-comment', [FrontendController::class, 'StoreComment'])->name('store.comment');
Route::post('store-contact-message', [FrontendController::class, 'StoreContactMessage'])->name('store.contact.message');

/*
|--------------------------------------------------------------------------
| Stuffs Super User Middleware
|--------------------------------------------------------------------------
*/
Route::middleware(['superuser'])->group(function () {
    Route::get('/stuffs/jokes/{filename}', [StuffController::class, 'show'])
        ->where('filename', '.*');
});


/*
|--------------------------------------------------------------------------
| Jokes Routes
|--------------------------------------------------------------------------
*/

Route::get('/', [JokeController::class, 'index'])->name('home');

// Joke routes
Route::prefix('jokes')->name('jokes.')->group(function () {
    Route::get('/', [JokeController::class, 'index'])->name('index');
    Route::get('/create', [JokeController::class, 'create'])->name('create');
    Route::post('/', [JokeController::class, 'store'])->name('store');
    Route::get('/random', [JokeController::class, 'random'])->name('random');
    Route::get('/{joke}', [JokeController::class, 'show'])->name('show');
    Route::get('/{joke}/edit', [JokeController::class, 'edit'])->name('edit');
    Route::put('/{joke}', [JokeController::class, 'update'])->name('update');
    Route::delete('/{joke}', [JokeController::class, 'destroy'])->name('destroy');

    // Additional routes
    Route::get('/category/{id}', [JokeController::class, 'byCategory'])->name('category');
    Route::post('/delete-multiple', [JokeController::class, 'destroyMultiple'])->name('destroyMultiple');
    Route::get('/export/csv', [JokeController::class, 'exportCsv'])->name('export.csv');
    Route::post('/{joke}/toggle-favorite', [JokeController::class, 'toggleFavorite'])->name('toggleFavorite');
});

// Jokecat (Category) routes
Route::prefix('categories')->name('jokecats.')->group(function () {
    Route::get('/', [JokecatController::class, 'index'])->name('index');
    Route::get('/create', [JokecatController::class, 'create'])->name('create');
    Route::post('/', [JokecatController::class, 'store'])->name('store');
    Route::get('/{jokecat}/edit', [JokecatController::class, 'edit'])->name('edit');
    Route::put('/{jokecat}', [JokecatController::class, 'update'])->name('update');
    Route::delete('/{jokecat}', [JokecatController::class, 'destroy'])->name('destroy');
});


/*
|--------------------------------------------------------------------------
| PMBOK SPA
|--------------------------------------------------------------------------
*/

Route::middleware(['auth'])->prefix('pmbok-spa')->name('pmbok.spa.')->group(function () {
    Route::get('/', \App\Livewire\PmbokSpa\Dashboard::class)->name('dashboard');
    Route::get('/projects', \App\Livewire\PmbokSpa\ProjectList::class)->name('projects');
    Route::get('/process/{processId}', \App\Livewire\PmbokSpa\ProcessPage::class)->name('process');
});

/*
|--------------------------------------------------------------------------
| SBOK FOUR
|--------------------------------------------------------------------------
*/


Route::get('/sbok-four', Sbokfour::class)->name('sbok-four');

/*
|--------------------------------------------------------------------------
| Livewire Component Routes
|--------------------------------------------------------------------------
*/

Route::get('/greeter', \App\Livewire\Greeter::class)->name('greeter');
Route::get('/', Home::class)->name('home');
Route::get('/home', Home::class); // secondary route without name
Route::get('/livewireprocs', Livewireprocs::class)->name('livewireprocs');

//Route::get('/about', \App\Livewire\Pmway\About::class)->name('about');

Route::get('/lwsearch', \App\Livewire\LWSearch::class);
Route::get('/calculator', \App\Livewire\Calculator::class)->name('calculator');
Route::get('/todo-list', \App\Livewire\TodoList::class)->name('todo-list');
Route::get('/cascading-dropdown', \App\Livewire\CascadingDropdown::class)->name('cascading-dropdown');
Route::get('/products', \App\Livewire\ProductsSearch::class)->name('products');
Route::get('/image-upload', \App\Livewire\ImageUpload::class)->name('image-upload');
Route::get('/registertest', \App\Livewire\RegisterForm::class)->name('registertest');


/*
|--------------------------------------------------------------------------
| ITIL Routes
|--------------------------------------------------------------------------
*/


Route::get('/view-pdf/{filename}', function ($filename) {
    $filePath = base_path('resources/views/livewire/pmway/itil/itil4guides/' . $filename);
    return file_exists($filePath) ? response()->file($filePath) : abort(404);
});

Route::get('/itiloverview', [IndexController::class, 'itiloverview']);
Route::get('/itilss', [IndexController::class, 'itilss']);
Route::get('/itilsd', [IndexController::class, 'itilsd']);
Route::get('/itilst', [IndexController::class, 'itilst']);
Route::get('/itilso', [IndexController::class, 'itilst']);
Route::get('/itilcsi', [IndexController::class, 'itilcsi']);

/*
|--------------------------------------------------------------------------
| Tailwind CSS Training Routes
|--------------------------------------------------------------------------
*/

Route::get('/twcsstraining', \App\Livewire\TWCSSTraining::class)->name('twcsstraining');
Route::get('/twcsstraining/{file}', function ($file) {
    $path = public_path('twcsstraining/' . $file);
    return file_exists($path) ? response()->file($path) : abort(404);
})->where('file', '.*');

/*
|--------------------------------------------------------------------------
| Authenticated Routes
|--------------------------------------------------------------------------
*/

Route::middleware(['auth', 'verified'])->group(function () {
    Route::get('/dashboard', \App\Livewire\Dashboard::class)->name('dashboard');
    Route::get('/pmwaysearch', \App\Livewire\PMWaySearch::class)->name('pmwaysearch');
    Route::post('/forcelogout', [AuthenticatedSessionController::class, 'destroy'])->name('forcelogout');

    // Document management
    Route::get('/document-uploads', [DocumentController::class, 'uploads'])->name('uploads')->middleware('permission:document uploads');
    Route::post('/document-upload', [DocumentController::class, 'upload'])->name('upload')->middleware('permission:document upload');
    Route::get('/documents', [DocumentController::class, 'documents'])->name('documents');
    Route::get('/downloadbyshortname/{shortname}', [DocumentController::class, 'downloadByShortName'])->name('downloadByShortName')->middleware('permission:download byshortname');
    Route::delete('/documents/{id}', [DocumentController::class, 'destroy'])->name('documents.destroy')->middleware('permission:documents destroy');
    Route::get('/documents/{id}/edit', [DocumentController::class, 'edit'])->name('documents.edit')->middleware('permission:documents edit');
    Route::put('/documents/{id}', [DocumentController::class, 'update'])->name('documents.update')->middleware('permission:documents update');
    Route::get('/docusearch/{term}', [DocumentController::class, 'search']);
    Route::get('/documents/{shortname}/download', [DocumentController::class, 'downloadByShortName'])->name('documents.download');

    // Image management
    Route::get('/image-uploads', [ImageController::class, 'uploads'])->name('image-uploading')->middleware('permission:document uploads');
    Route::post('/image-upload', [ImageController::class, 'upload'])->name('uploading')->middleware('permission:image upload');
    Route::get('/images', [ImageController::class, 'images'])->name('images');
    Route::delete('/images/{id}', [ImageController::class, 'destroy'])->name('images.destroy')->middleware('permission:images destroy');
    Route::get('/images/{id}/edit', [ImageController::class, 'edit'])->name('images.edit')->middleware('permission:images edit');
    Route::put('/images/{id}', [ImageController::class, 'update'])->name('images.update')->middleware('permission:images update');
    Route::get('/images/{shortname}/download', [ImageController::class, 'downloadByShortName'])->name('images.download');

    // Blog posts
    Route::post('/update-post-status', [BlogPostController::class, 'updatePostStatus'])->name('update.post.status')->middleware('permission:blog approved');
    Route::get('/useraddpost', [UserPostsBlogPostController::class, 'UserAddPost'])->name('user.add.post');
    Route::post('/userstorepost', [UserPostsBlogPostController::class, 'UserStorePost'])->name('user.store.post');
    Route::get('/search', [UserPostsBlogPostController::class, 'usersearch'])->name('usersearch');
    Route::get('/post/details', [UserPostsBlogPostController::class, 'firstPost'])->name('first.post');

    Route::controller(BlogPostController::class)->group(function () {
        Route::get('all-post', 'AllPost')->middleware('permission:all post')->name('all.post');
        Route::get('/blogsbyauthor', 'blogsByAuthor')->middleware('permission:all postsbyauthor')->name('blogs.by.author');
        Route::get('add-post', 'AddPost')->middleware('permission:add post')->name('add.post');
        Route::post('store-post', 'StorePost')->middleware('permission:store post')->name('store.post');
        Route::get('edit-post/{id}', 'EditPost')->middleware('permission:edit post')->name('edit.post');
        Route::post('update-post/{id}', 'UpdatePost')->middleware('permission:update post')->name('update.post');
        Route::get('delete-post/{id}', 'DeletePost')->middleware('permission:delete post')->name('delete.post');
    });

    // The LiveWire Voting buttons link to most voted page which is also at the bottom of each blog in bootstrap section:
    Route::get('/most-voted-posts', [FrontendController::class, 'MostVotedPosts'])->name('most.voted');

    // New Blog - Most Voted Posts
    Route::get('/new-blog/most-voted', function () {
        return view('most-voted-new-blog');
    })->name('new.blog.most.voted');

// The LiveWire Voting buttons link to most voted page which is also at the bottom of each blog in tailwind section:
    Route::get('/top-voted-posts', function () {
        return view('tailwind-most-voted');
    })->name('tailwind.most.voted');


    // View Single Post //add to above when ready
    Route::get('/post/{post}', [BlogPostController::class, 'viewSinglePost'])->name('view.post');
    // Portfolio dashboard
    // View Single Post (Admin) //add to above when ready
    Route::get('/admin/post/{post}', [BlogPostController::class, 'viewSinglePost'])->name('view.post');


    Route::get('/portfoliodash', [AdminController::class, 'PortfolioDash'])->name('portfoliodash')->middleware('permission:portfolio dash');


    ////////////// NB NEW BLOG POST ROUTES ////////////////

    // Blog routes (authenticated users)
    Route::middleware(['auth'])->group(function () {
        // Following feed
        Route::get('/writestuff', Writefull::class)->name('writestuff');

        // Create post
        Route::get('/blog/create', CreatePost::class)->name('blog.create');

        // Edit post
        Route::get('/blog/post/{post}/edit', EditPost::class)->name('blog.edit');
    });

// Public blog routes (everyone can view)
    Route::get('/blog/post/{post}', SinglePost::class)->name('blog.post');
    Route::get('/blog/profile/{user:name}', ProfilePosts::class)->name('blog.profile');

///////////////////////////////////////////////////////////
    // Hero section
    Route::controller(HeroController::class)->group(function () {
        Route::get('here-section', 'HeroSection')->name('hero.section')->middleware('permission:all hero');
        Route::post('update-here-section', 'UpdateHeroSection')->name('update.here.section')->middleware('permission:update hero');
    });

    // Services
    Route::controller(ServicesController::class)->group(function () {
        Route::get('all-services', 'AllServices')->name('all.services')->middleware('permission:all service');
        Route::get('add-service', 'AddService')->name('add.service')->middleware('permission:add service');
        Route::post('store-service', 'StoreService')->name('store.service')->middleware('permission:store service');
        Route::get('edit-service/{id}', 'EditService')->name('edit.service')->middleware('permission:edit service');
        Route::post('update-service', 'UpdateService')->name('update.service')->middleware('permission:update service');
        Route::get('delete-service/{id}', 'DeleteService')->name('delete.service')->middleware('permission:delete service');
    });

    // Portfolio/Recent works
    Route::controller(PortfolioController::class)->group(function () {
        Route::get('all-recent-works', 'AllRecentWorks')->name('all.recent.works')->middleware('permission:all work');
        Route::get('all-work', 'AddWork')->name('add.work')->middleware('permission:add work');
        Route::post('store-work', 'StoreWork')->name('store.work')->middleware('permission:store work');
        Route::get('edit-word/{id}', 'EditWork')->name('edit.work')->middleware('permission:edit work');
        Route::post('update-work', 'UpdateWork')->name('update.work')->middleware('permission:update work');
        Route::get('delete-word/{id}', 'DeleteWork')->name('delete.work')->middleware('permission:delete work');
    });

    // Experience & Education
    Route::controller(ResumeController::class)->group(function () {
        Route::get('my-experience', 'MyExperience')->name('my.experience')->middleware('permission:all experience');
        Route::post('store-experience', 'StoreExperience')->name('store.experience')->middleware('permission:store experience');
        Route::get('edit-experience/{id}', 'EditExperience')->middleware('permission:edit experience');
        Route::post('update-experience', 'UpdateExperience')->name('update.experience')->middleware('permission:update experience');
        Route::get('delete-experience/{id}', 'DeleteExperience')->name('delete.experience')->middleware('permission:delete experience');
        Route::get('my-education', 'MyEducation')->name('my.education')->middleware('permission:all education');
    });

    // Skills
    Route::controller(SkillsController::class)->group(function () {
        Route::get('add-skill', 'AddSkill')->name('add.skill')->middleware('permission:add skill');
        Route::post('store-skill', 'StoreSkill')->name('store.skill')->middleware('permission:store skill');
        Route::get('all-skills', 'AllSkills')->name('all.skills')->middleware('permission:all skill');
        Route::get('edit-skill/{id}', 'EditSkill')->name('edit.skill')->middleware('permission:edit skill');
        Route::post('update-skill', 'UpdateSkill')->name('update.skill')->middleware('permission:update skill');
        Route::get('delete-skill/{id}', 'DeleteSkill')->name('delete.skill')->middleware('permission:delete skill');
    });

    // Testimonials
    Route::controller(TestimonialController::class)->group(function () {
        Route::get('add-testimony', 'AddTestimony')->name('add.testimony')->middleware('permission:add testimony');
        Route::post('store-testimony', 'StoreTestimony')->name('store.testimony')->middleware('permission:store testimony');
        Route::get('all-testimoies', 'AllTestimonies')->name('all.testimoies')->middleware('permission:all testimony');
        Route::get('edit-testimony/{id}', 'EditTestimony')->name('edit.testimony')->middleware('permission:edit testimony');
        Route::post('update-testimony', 'UpdateTestimony')->name('update.testimony')->middleware('permission:update testimony');
        Route::get('delete-testimony/{id}', 'DeleteTestimony')->name('delete.testimony')->middleware('permission:delete testimony');
    });

    // Comments & Contacts
    Route::controller(CommentController::class)->group(function () {
        Route::get('user-comments', 'UserComments')->name('user.comments');
        Route::post('comment-status-update', 'CommentStatusUpdate')->name('comment.status.update')->middleware('permission:update comment');
        Route::get('contact-message', 'ContactMessage')->name('contact.message')->middleware('permission:all contact');
        Route::get('delete-contact/{id}', 'DeleteContact')->name('delete.contact')->middleware('permission:delete contact');
    });

    // Site Settings
    Route::controller(SiteSettingsController::class)->group(function () {
        Route::get('site-settings', 'SiteSettings')->name('site.settings')->middleware('permission:all setting');
        Route::post('update-site-settings', 'UpdateSiteSettings')->name('update.site.settings')->middleware('permission:update setting');
    });

    // Impersonation
    Route::post('/impersonate/{user}', [\App\Http\Controllers\ImpersonationController::class, 'store'])->name('impersonate.store')->middleware('permission:impersonate');
    Route::delete('/impersonate/stop', [\App\Http\Controllers\ImpersonationController::class, 'destroy'])->name('impersonate.destroy');

    // Settings
    Route::redirect('settings', 'settings/profile');
    Route::get('settings/profile', \App\Livewire\Settings\Profile::class)->name('settings.profile');
    Route::get('settings/password', \App\Livewire\Settings\Password::class)->name('settings.password');
    Route::get('settings/appearance', \App\Livewire\Settings\Appearance::class)->name('settings.appearance');
    Route::get('settings/locale', \App\Livewire\Settings\Locale::class)->name('settings.locale');

    // Admin routes
    Route::prefix('admin')->as('admin.')->group(function () {
        Route::get('/', \App\Livewire\Admin\Index::class)->name('index')->middleware('permission:access dashboard');
        Route::get('/users', \App\Livewire\Admin\Users::class)->name('users.index')->middleware('permission:view users');
        Route::get('/users/create', \App\Livewire\Admin\Users\CreateUser::class)->name('users.create')->middleware('permission:create users');
        Route::get('/users/{user}', \App\Livewire\Admin\Users\ViewUser::class)->name('users.show')->middleware('permission:view users');
        Route::get('/users/{user}/edit', \App\Livewire\Admin\Users\EditUser::class)->name('users.edit')->middleware('permission:update users');
        Route::get('/roles', \App\Livewire\Admin\Roles::class)->name('roles.index')->middleware('permission:view roles');
        Route::get('/roles/create', \App\Livewire\Admin\Roles\CreateRole::class)->name('roles.create')->middleware('permission:create roles');
        Route::get('/roles/{role}/edit', \App\Livewire\Admin\Roles\EditRole::class)->name('roles.edit')->middleware('permission:update roles');
        Route::get('/permissions', \App\Livewire\Admin\Permissions::class)->name('permissions.index')->middleware('permission:view permissions');
        Route::get('/permissions/create', \App\Livewire\Admin\Permissions\CreatePermission::class)->name('permissions.create')->middleware('permission:create permissions');
        Route::get('permissions/{permission}/edit', \App\Livewire\Admin\Permissions\EditPermission::class)->name('permissions.edit')->middleware('permission:update permissions');
    });

    // Protected content routes
    Route::middleware('role:Super Admin')->group(function () {
        Route::get('/privateone', PrivateOne::class);
    });


    Route::get('/scrumvidlessons', [IndexController::class, 'scrumvidlessons']);





    // CMMi converted to Livewire


    Route::get('/capability-maturity-model', CapabilityMaturityModel::class)->name('cmm');

    // PMBOK Six routes
    Route::prefix('pmboksix')->controller(PmboksixController::class)->group(function () {
        Route::get('initiate', 'initiate');
        Route::get('plan', 'plan');
        Route::get('execute', 'execute');
        Route::get('monitorandcontrol', 'monitorandcontrol');
        Route::get('close', 'close');
        Route::get('pmbokprocessnutshell', 'pmbokprocessnutshell');
        Route::get('pmnotes', 'pmnotes');
        Route::get('integration', 'integration');
        Route::get('communication', 'communication');
        Route::get('procurement', 'procurement');
        Route::get('quality', 'quality');
        Route::get('resource', 'resource');
        Route::get('risk', 'risk');
        Route::get('schedule', 'schedule');
        Route::get('scope', 'scope');
        Route::get('cost', 'cost');
        Route::get('stakeholder', 'stakeholder');

        // Knowledge area processes
        foreach (['four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen'] as $prefix) {
            foreach (['one', 'two', 'three', 'four', 'five', 'six', 'seven'] as $suffix) {
                Route::get("{$prefix}{$suffix}", $prefix . $suffix);
            }
        }
    });
});

/*
|--------------------------------------------------------------------------
| User Routes (mustBeLoggedIn middleware)
|--------------------------------------------------------------------------
*/

Route::middleware('mustBeLoggedIn')->group(function () {
//    Route::get('/writestuff', [UserController::class, "showCorrectHomepage"])->middleware('auth')->name('writestuff');
    Route::get('/manage-avatar', Avatarform::class);
//     Route::post('/create-follow/{user:name}', [FollowController::class, 'createFollow']);
//     Route::post('/remove-follow/{user:name}', [FollowController::class, 'removeFollow']);
    Route::get('/create-post', [BlogPostController::class, 'showCreateForm'])->name('create-post')->middleware('verified');
    Route::post('/create-post', [BlogPostController::class, 'storeNewPost'])->middleware('verified');
//
//    // Chat
//    Route::post('/send-chat-message', function (Request $request) {
//        $formFields = $request->validate(['textvalue' => 'required']);
//        if (!trim(strip_tags($formFields['textvalue']))) {
//            return response()->noContent();
//        }
//        broadcast(new ChatMessage([
//            'name' => auth()->user()->name,
//            'textvalue' => strip_tags($request->textvalue),
//            'avatar' => auth()->user()->avatar
//        ]))->toOthers();
//        return response()->noContent();
//    });
});

// Blog public routes
Route::get('/post/{post}', [BlogPostController::class, 'viewSinglePost']);
Route::get('/post/{post}/edit', [BlogPostController::class, 'showEditForm'])->middleware(['auth', 'verified', 'permission:edit post']);
Route::put('/post/{post}', [BlogPostController::class, 'actuallyUpdate'])->middleware('can:update,post');
Route::get('/search/{term}', [BlogPostController::class, 'search']);

// below may be redundant

 //Profile routes

Route::get('/profile/{user:name}', [UserController::class, 'profile']);
// Route::get('/profile/{user:name}/followers', [UserController::class, 'profileFollowers']);
// Route::get('/profile/{user:name}/following', [UserController::class, 'profileFollowing']);

Route::middleware('cache.headers:public;max_age=20;etag')->group(function () {
    Route::get('/profile/{user:name}/raw', [UserController::class, 'profileRaw']);
//     Route::get('/profile/{user:name}/followers/raw', [UserController::class, 'profileFollowersRaw']);
//     Route::get('/profile/{user:name}/following/raw', [UserController::class, 'profileFollowingRaw']);
});

/*
|--------------------------------------------------------------------------
| Legacy PMWay Routes
|--------------------------------------------------------------------------
*/

//Route::get('/pmway', [IndexController::class, 'pmway'])->name('pmway');
//Route::get('/pin', [IndexController::class, 'pin']);
//Route::get('/cmmi', [IndexController::class, 'cmmi']);
//Route::get('/scrumrca', [IndexController::class, 'scrumrca']);
//Route::get('/team', [IndexController::class, 'team']);

//Route::get('/agile', [IndexController::class, 'agile']);
//Route::get('/kanbancoffee', [IndexController::class, 'kanbancoffee']);
Route::get('/freedoms', [IndexController::class, 'freedoms']);
//Route::get('/hamandeggs', [IndexController::class, 'hamandeggs']);
Route::get('/baseline', [IndexController::class, 'baseline']);
//Route::get('/waterfallvsagile', [IndexController::class, 'waterfallvsagile']);
//Route::get('/vmodel', [IndexController::class, 'vmodel']);
//Route::get('/scrumvaluemodel', [IndexController::class, 'scrumvaluemodel']);
Route::get('/dml', [IndexController::class, 'dml']);
Route::get('/scrumroleclarity', [IndexController::class, 'scrumroleclarity']);
//Route::get('/sevenrulesofscrum', [IndexController::class, 'sevenrulesofscrum']);
//Route::get('/agileisdead', [IndexController::class, 'agileisdead']);
//Route::get('/workingsoftware', [IndexController::class, 'workingsoftware']);
//Route::get('/productincrement', [IndexController::class, 'productincrement']);
//Route::get('/burndown', [IndexController::class, 'burndown']);
//Route::get('/release', [IndexController::class, 'release']);
//Route::get('/safeisunsafe', [IndexController::class, 'safeisunsafe']);
Route::get('/procrastination', [IndexController::class, 'procrastination']);
Route::get('/recharge', [IndexController::class, 'recharge']);
Route::get('/measurement', [IndexController::class, 'measurement']);
Route::get('/monkey', [IndexController::class, 'monkey']);
Route::get('/test', [IndexController::class, 'test']);
//Route::get('/itilfourpractices', [IndexController::class, 'itilfourpractices']);
//Route::get('/home/waterfallvsagile', [IndexController::class, 'waterfallvsagile']);

/*
|--------------------------------------------------------------------------
| PHPMailer Routes
|--------------------------------------------------------------------------
*/

Route::get("email", [MailerController::class, "email"])->name("email");
Route::post("send-email", [MailerController::class, "composeEmail"])->name("send-email");

/*
|--------------------------------------------------------------------------
| Admin-Only Routes
|--------------------------------------------------------------------------
*/

Route::get('/admins-only', function () {
    return 'Only admins should be able to see this page';
})->middleware('can:visitAdminPages');

require __DIR__ . '/auth.php';
